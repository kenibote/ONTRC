{% extends "base.html" %}

<!-- 页面标题 -->
{% block PageTitle %} WSS设置 {% endblock %}
{% block AdditionScript %}
    <script src="/statics/js/topInfo.js"></script>
{% endblock %}

{% block titleURL%} /index/ {% endblock %}
{% block title %}
    <span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
    ONTRC
{% endblock %}


{% block MainContents %}
    <h3>WSS设备设置面板 <span class="label label-default btn-sm">4 Devices</span> </h3>
    <hr>

    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
        <div class="panel panel-success">
            <div class="panel-heading" role="tab" id="headingOne">
                <h4 class="panel-title">
                <a role="button" data-toggle="collapse" data-parent="#accordion"
                   href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    WSS #1 当前信息
                </a>
                </h4>
            </div>
            <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel"
                 aria-labelledby="headingOne">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-1">
                            <button type="button" class="btn btn-danger"
                                    id="stopserver1" value="1">停止服务</button>
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn"
                                    id="startserver1" value="1" disabled>启动服务</button>
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn"
                                    id="comformchange1" value="1" disabled>确认修改</button>
                        </div>
                    </div> <!-- end row-->
                    <hr>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-warning">
                          <span class="input-group-addon">WSS型号</span>
                          <input type="text" class="form-control wssinput1"
                                 value="{{ wssinfo1.wsstype }}" id="wsstype1" disabled>
                        </div>
                    </div>

                    <form class="form-inline" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="form-group">
                            <div class="input-group has-success">
                                <div class="input-group-addon">IP:</div>
                                <input type="text" class="form-control wssinput1"
                                       value="{{ wssinfo1.wssip }}" id="wssip1" disabled>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="input-group has-success">
                                <div class="input-group-addon">Port:</div>
                                <input type="text" class="form-control wssinput1"
                                       value="{{ wssinfo1.wssport }}" id="wssport1" disabled>
                            </div>
                        </div>
                    </form>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-success">
                          <span class="input-group-addon">鉴权码：</span>
                          <input type="text" class="form-control wssinput1"
                                 value="{{ wssinfo1.wsskey }}" id="wsskey1" disabled>
                        </div>
                    </div>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-success">
                          <span class="input-group-addon">位置：</span>
                          <input type="text" class="form-control wssinput1"
                                 value="{{ wssinfo1.wsslocation }}" id="wsslocation1" disabled>
                        </div>
                    </div>

                    <hr>
                </div>
            </div>
        </div>

        <div class="panel panel-success">
            <div class="panel-heading" role="tab" id="headingTwo">
                <h4 class="panel-title">
                    <a class="collapsed" role="button" data-toggle="collapse"
                       data-parent="#accordion" href="#collapseTwo" aria-expanded="false"
                       aria-controls="collapseTwo">
                        WSS #2 当前信息
                    </a>
                </h4>
            </div>
            <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel"
                 aria-labelledby="headingTwo">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-1">
                            <button type="button" class="btn btn-danger"
                                    id="stopserver2" value="2">停止服务</button>
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn"
                                    id="startserver2" value="2" disabled>启动服务</button>
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn"
                                    id="comformchange2" value="2" disabled>确认修改</button>
                        </div>
                    </div> <!-- end row-->
                    <hr>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-warning">
                          <span class="input-group-addon">WSS型号</span>
                          <input type="text" class="form-control wssinput2"
                                 value="{{ wssinfo2.wsstype }}" id="wsstype2" disabled>
                        </div>
                    </div>

                    <form class="form-inline" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="form-group">
                            <div class="input-group has-success">
                                <div class="input-group-addon">IP:</div>
                                <input type="text" class="form-control wssinput2"
                                       value="{{ wssinfo2.wssip }}" id="wssip2" disabled>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="input-group has-success">
                                <div class="input-group-addon">Port:</div>
                                <input type="text" class="form-control wssinput2"
                                       value="{{ wssinfo2.wssport }}" id="wssport2" disabled>
                            </div>
                        </div>
                    </form>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-success">
                          <span class="input-group-addon">鉴权码：</span>
                          <input type="text" class="form-control wssinput2"
                                 value="{{ wssinfo2.wsskey }}" id="wsskey2" disabled>
                        </div>
                    </div>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-success">
                          <span class="input-group-addon">位置：</span>
                          <input type="text" class="form-control wssinput2"
                                 value="{{ wssinfo2.wsslocation }}" id="wsslocation2" disabled>
                        </div>
                    </div>

                    <hr>
                </div>
            </div>
        </div>

        <div class="panel panel-success">
            <div class="panel-heading" role="tab" id="headingThree">
                <h4 class="panel-title">
                    <a class="collapsed" role="button" data-toggle="collapse"
                       data-parent="#accordion" href="#collapseThree" aria-expanded="false"
                       aria-controls="collapseThree">
                        WSS #3 当前信息
                    </a>
                </h4>
            </div>
            <div id="collapseThree" class="panel-collapse collapse" role="tabpanel"
                 aria-labelledby="headingThree">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-1">
                            <button type="button" class="btn btn-danger"
                                    id="stopserver3" value="3">停止服务</button>
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn"
                                    id="startserver3" value="3" disabled>启动服务</button>
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn"
                                    id="comformchange3" value="3" disabled>确认修改</button>
                        </div>
                    </div> <!-- end row-->
                    <hr>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-warning">
                          <span class="input-group-addon">WSS型号</span>
                          <input type="text" class="form-control wssinput3"
                                 value="{{ wssinfo3.wsstype }}" id="wsstype3" disabled>
                        </div>
                    </div>

                    <form class="form-inline" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="form-group">
                            <div class="input-group has-success">
                                <div class="input-group-addon">IP:</div>
                                <input type="text" class="form-control wssinput3"
                                       value="{{ wssinfo3.wssip }}" id="wssip3" disabled>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="input-group has-success">
                                <div class="input-group-addon">Port:</div>
                                <input type="text" class="form-control wssinput3"
                                       value="{{ wssinfo3.wssport }}" id="wssport3" disabled>
                            </div>
                        </div>
                    </form>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-success">
                          <span class="input-group-addon">鉴权码：</span>
                          <input type="text" class="form-control wssinput3"
                                 value="{{ wssinfo3.wsskey }}" id="wsskey3" disabled>
                        </div>
                    </div>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-success">
                          <span class="input-group-addon">位置：</span>
                          <input type="text" class="form-control wssinput3"
                                 value="{{ wssinfo3.wsslocation }}" id="wsslocation3" disabled>
                        </div>
                    </div>

                    <hr>
                </div>
            </div>
        </div>

        <div class="panel panel-success">
            <div class="panel-heading" role="tab" id="headingFour">
                <h4 class="panel-title">
                    <a class="collapsed" role="button" data-toggle="collapse"
                       data-parent="#accordion" href="#collapseFour" aria-expanded="false"
                       aria-controls="collapseFour">
                        WSS #4 当前信息
                    </a>
                </h4>
            </div>
            <div id="collapseFour" class="panel-collapse collapse" role="tabpanel"
                 aria-labelledby="headingFour">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-1">
                            <button type="button" class="btn btn-danger"
                                    id="stopserver4" value="4">停止服务</button>
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn"
                                    id="startserver4" value="4" disabled>启动服务</button>
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn"
                                    id="comformchange4" value="4" disabled>确认修改</button>
                        </div>
                    </div> <!-- end row-->
                    <hr>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-warning">
                          <span class="input-group-addon">WSS型号</span>
                          <input type="text" class="form-control wssinput4"
                                 value="{{ wssinfo4.wsstype }}" id="wsstype4" disabled>
                        </div>
                    </div>

                    <form class="form-inline" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="form-group">
                            <div class="input-group has-success">
                                <div class="input-group-addon">IP:</div>
                                <input type="text" class="form-control wssinput4"
                                       value="{{ wssinfo4.wssip }}" id="wssip4" disabled>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="input-group has-success">
                                <div class="input-group-addon">Port:</div>
                                <input type="text" class="form-control wssinput4"
                                       value="{{ wssinfo4.wssport }}" id="wssport4" disabled>
                            </div>
                        </div>
                    </form>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-success">
                          <span class="input-group-addon">鉴权码：</span>
                          <input type="text" class="form-control wssinput4"
                                 value="{{ wssinfo4.wsskey }}" id="wsskey4" disabled>
                        </div>
                    </div>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-success">
                          <span class="input-group-addon">位置：</span>
                          <input type="text" class="form-control wssinput4"
                                 value="{{ wssinfo4.wsslocation }}" id="wsslocation4" disabled>
                        </div>
                    </div>

                    <hr>
                </div>
            </div>
        </div>

    </div>
    <hr>

    <!-- 显示日志信息 -->
    <div class="panel panel-info">
        <div class="panel-heading">操作记录(仅显示最近10条信息)</div>
        <div class="panel-body">
            <table class="table table-striped table-hover">
                <thead> <tr>
                    <th>ID</th> <th>Time</th> <th>Info</th>
                </tr> </thead>

                <tbody id="tablelog"></tbody>
            </table>
        </div> <!-- panel-body-->
    </div> <!-- end panel logging-->

{% endblock %}


{% block script %}
    <script>
        //提示信息消失时间
        var hidetime = 6000;
        var logtime = 1500;
        //设置标题导航栏为选中状态
        $("#DHTsetting").addClass("active");

        //当页面载入后，根据服务器记录的信息对按钮进行操作
        $(document).ready(function () {
            var wssstate1 = "{{ wssinfo1.wssstate }}";
            var wssstate2 = "{{ wssinfo2.wssstate }}";
            var wssstate3 = "{{ wssinfo3.wssstate }}";
            var wssstate4 = "{{ wssinfo4.wssstate }}";

            if(wssstate1=="ON"){
                //如果服务器是启动的，则默认样式，不用做任何操作
            }else{
                //如果服务器是没有启动的
                $("#stopserver1").attr("disabled","disabled").removeClass("btn-danger");
                $("#startserver1").removeAttr("disabled").addClass("btn-success");
                $("#comformchange1").removeAttr("disabled").addClass("btn-warning");
                $(".wssinput1").removeAttr("disabled");
            }

            if(wssstate2=="ON"){
                //如果服务器是启动的，则默认样式，不用做任何操作
            }else{
                //如果服务器是没有启动的
                $("#stopserver2").attr("disabled","disabled").removeClass("btn-danger");
                $("#startserver2").removeAttr("disabled").addClass("btn-success");
                $("#comformchange2").removeAttr("disabled").addClass("btn-warning");
                $(".wssinput2").removeAttr("disabled");
            }

            if(wssstate3=="ON"){
                //如果服务器是启动的，则默认样式，不用做任何操作
            }else{
                //如果服务器是没有启动的
                $("#stopserver3").attr("disabled","disabled").removeClass("btn-danger");
                $("#startserver3").removeAttr("disabled").addClass("btn-success");
                $("#comformchange3").removeAttr("disabled").addClass("btn-warning");
                $(".wssinput3").removeAttr("disabled");
            }

            if(wssstate4=="ON"){
                //如果服务器是启动的，则默认样式，不用做任何操作
            }else{
                //如果服务器是没有启动的
                $("#stopserver4").attr("disabled","disabled").removeClass("btn-danger");
                $("#startserver4").removeAttr("disabled").addClass("btn-success");
                $("#comformchange4").removeAttr("disabled").addClass("btn-warning");
                $(".wssinput4").removeAttr("disabled");
            }

            //获取log日志
            setTimeout(getlog,100);
        });

        $("#stopserver1,#stopserver2,#stopserver3,#stopserver4").click(function () {
            var id = $(this).val();

            $("#stopserver"+id).attr("disabled","disabled");
            $("#stopserver"+id).text("Runing...");
            $("#Topinfo2").removeClass("hide");

            $.ajax({
                url: "/ajax_wsssetting_stop/",
                type: "POST",
                data: {"Device":id},
                dataType: "json",
                success:function (data) {
                    $("#stopserver"+id).removeAttr("disabled");
                    $("#stopserver"+id).text("停止服务");

                    if(data["result"]=="success"){
                        ShowTopInfo1("alert-success","<strong>Success!</strong> WSS#"+id+" 服务暂停成功！");
                        //当点击停止服务的时候，自己按钮变暗；其它所有按钮启用
                        $("#stopserver"+id).attr("disabled","disabled").removeClass("btn-danger");
                        $("#startserver"+id).removeAttr("disabled").addClass("btn-success");
                        $("#comformchange"+id).removeAttr("disabled").addClass("btn-warning");
                        $(".wssinput"+id).removeAttr("disabled");

                    }else{
                        ShowTopInfo1("alert-danger","<strong>Error!</strong> WSS#"+id+" 服务暂停失败！");
                    }
                    setTimeout(function () {$("#Topinfo1").empty();},hidetime);
                    $("#Topinfo2").addClass("hide");
                }
            }); // end ajax

            //获取log日志
            setTimeout(getlog,logtime);
        }); // end stop server

        $("#startserver1,#startserver2,#startserver3,#startserver4").click(function () {
            var id = $(this).val();

            $("#startserver"+id).attr("disabled","disabled");
            $("#startserver"+id).text("Runing...");
            $("#Topinfo2").removeClass("hide");

            $.ajax({
                url: "/ajax_wsssetting_start/",
                type: "POST",
                data: {"Device":id},
                dataType: "json",
                success:function (data) {
                    $("#startserver"+id).removeAttr("disabled");
                    $("#startserver"+id).text("启动服务");

                    if(data["result"]=="success"){
                        ShowTopInfo1("alert-success","<strong>Success!</strong> WSS#"+id+" 服务启动成功！");
                        $("#stopserver"+id).removeAttr("disabled").addClass("btn-danger");
                        $("#startserver"+id).attr("disabled","disabled").removeClass("btn-success");
                        $("#comformchange"+id).attr("disabled","disabled").removeClass("btn-warning");
                        $(".wssinput"+id).attr("disabled","disabled");

                    }else{
                        ShowTopInfo1("alert-danger","<strong>Error!</strong> WSS#"+id+" 服务启动失败！");
                    }
                    setTimeout(function () {$("#Topinfo1").empty();},hidetime);
                    $("#Topinfo2").addClass("hide");
                }
            }); //end ajax

            //获取log日志
            setTimeout(getlog,logtime);
        });// end start server

        $("#comformchange1,#comformchange2,#comformchange3,#comformchange4").click(function () {
            var id = $(this).val();

            $("#comformchange"+id).attr("disabled","disabled");
            $("#comformchange"+id).text("Runing...");
            $("#Topinfo2").removeClass("hide");

            //此时应该检查出入并更新数据库
            var wsstypein = $("#wsstype"+id).val();
            var wssipin = $("#wssip"+id).val();
            var wssportin = $("#wssport"+id).val();
            var wsskeyin = $("#wsskey"+id).val();
            var wsslocationin = $("#wsslocation"+id).val();

            $.ajax({
                url: "/ajax_wsssetting_change/",
                type: "POST",
                data: {"Device":id, "wsslocation":wsslocationin,
                    "wsstype":wsstypein,"wssip":wssipin,
                    "wssport":wssportin,"wsskey":wsskeyin},
                dataType: "json",
                success:function (data) {
                    $("#comformchange"+id).removeAttr("disabled");
                    $("#comformchange"+id).text("确认修改");

                    if(data["result"]=="success"){
                        ShowTopInfo1("alert-success","<strong>Success!</strong> 写入数据库成功！");
                    }else{
                        ShowTopInfo1("alert-danger","<strong>Error!</strong> 请检查你的数据！");
                    }
                    setTimeout(function () {$("#Topinfo1").empty();},hidetime);
                    $("#Topinfo2").addClass("hide");
                }
            }); // end ajax

            //获取log日志
            setTimeout(getlog,logtime);
        }); // end change information


        //获取日志信息
        function getlog() {
            $.ajax({
                url: "/ajax_wsssetting_getlog/",
                type: "POST",
                data: {"None":"None"},
                dataType: "json",
                traditional:true,
                success:function (data) {
                    $("#tablelog").empty();
                    var count=data.data.length-1;
                    for(;count>=0;count-=3){
                        var addin = '<tr> <th scope="row">'+data.data[count-2]+
                            '</th> <td>'+data.data[count-1]+
                            '</td> <td>'+data.data[count]+
                            '</td> </tr>';
                        $("#tablelog").append(addin);
                    }
                }
            }); // end ajax
        } //end getlog



    </script>
{% endblock %}
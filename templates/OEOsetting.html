{% extends "base.html" %}

<!-- 页面标题 -->
{% block PageTitle %} OEO设置 {% endblock %}
{% block AdditionScript %}
    <script src="/statics/js/topInfo.js"></script>
{% endblock %}

{% block titleURL%} /index/ {% endblock %}
{% block title %}
    <span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
    ONTRC
{% endblock %}


{% block MainContents %}
    <h3>OEO设备设置面板 <span class="label label-default btn-sm">2 Devices</span> </h3>
    <hr>

    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
        <div class="panel panel-warning">
            <div class="panel-heading" role="tab" id="headingOne">
                <h4 class="panel-title">
                <a role="button" data-toggle="collapse" data-parent="#accordion"
                   href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    OEO #1 当前信息
                </a>
                </h4>
            </div>
            <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel"
                 aria-labelledby="headingOne">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-1">
                            <button type="button" class="btn btn-danger"
                                    id="stopserver1">停止服务</button>
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn"
                                    id="startserver1" disabled>启动服务</button>
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn"
                                    id="comformchange1" disabled>确认修改</button>
                        </div>
                    </div> <!-- end row-->
                    <hr>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-warning">
                          <span class="input-group-addon">OEO型号</span>
                          <input type="text" class="form-control oeoinput1"
                                 value="{{ oeoinfo1.oeoname }}" id="oeoname1" disabled>
                        </div>
                    </div>

                    <form class="form-inline" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="form-group">
                            <div class="input-group has-success">
                                <div class="input-group-addon">IP:</div>
                                <input type="text" class="form-control oeoinput1"
                                       value="{{ oeoinfo1.oeoip }}" id="oeoip1" disabled>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="input-group has-success">
                                <div class="input-group-addon">Port:</div>
                                <input type="text" class="form-control oeoinput1"
                                       value="{{ oeoinfo1.oeoport }}" id="oeoport1" disabled>
                            </div>
                        </div>
                    </form>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-success">
                          <span class="input-group-addon">鉴权码：</span>
                          <input type="text" class="form-control oeoinput1"
                                 value="{{ oeoinfo1.oeokey }}" id="oeokey1" disabled>
                        </div>
                    </div>

                    <hr>
                </div>
            </div>
        </div>

        <div class="panel panel-warning">
            <div class="panel-heading" role="tab" id="headingTwo">
                <h4 class="panel-title">
                    <a class="collapsed" role="button" data-toggle="collapse"
                       data-parent="#accordion" href="#collapseTwo" aria-expanded="false"
                       aria-controls="collapseTwo">
                        OEO #2 当前信息
                    </a>
                </h4>
            </div>
            <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel"
                 aria-labelledby="headingTwo">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-1">
                            <button type="button" class="btn btn-danger"
                                    id="stopserver2">停止服务</button>
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn"
                                    id="startserver2" disabled>启动服务</button>
                        </div>
                        <div class="col-md-1">
                            <button type="button" class="btn"
                                    id="comformchange2" disabled>确认修改</button>
                        </div>
                    </div> <!-- end row-->
                    <hr>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-warning">
                          <span class="input-group-addon">OEO型号</span>
                          <input type="text" class="form-control oeoinput2"
                                 value="{{ oeoinfo2.oeoname }}" id="oeoname2" disabled>
                        </div>
                    </div>

                    <form class="form-inline" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="form-group">
                            <div class="input-group has-success">
                                <div class="input-group-addon">IP:</div>
                                <input type="text" class="form-control oeoinput2"
                                       value="{{ oeoinfo2.oeoip }}" id="oeoip2" disabled>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="input-group has-success">
                                <div class="input-group-addon">Port:</div>
                                <input type="text" class="form-control oeoinput2"
                                       value="{{ oeoinfo2.oeoport }}" id="oeoport2" disabled>
                            </div>
                        </div>
                    </form>

                    <div class="row" style="margin-left: 5px; margin-bottom: 5px">
                        <div class="col-md-6 input-group has-success">
                          <span class="input-group-addon">鉴权码：</span>
                          <input type="text" class="form-control oeoinput2"
                                 value="{{ oeoinfo2.oeokey }}" id="oeokey2" disabled>
                        </div>
                    </div>

                    <hr>
                </div>
            </div>
        </div>
    </div>
    <hr>

    <!-- 显示日志信息 -->
    <div class="panel panel-info">
        <div class="panel-heading">操作记录(仅显示最近10条信息)</div>
        <div class="panel-body">
            <table class="table table-striped table-hover">
                <thead> <tr>
                    <th>ID</th> <th>Time</th> <th>Info</th>
                </tr> </thead>

                <tbody id="tablelog"></tbody>
            </table>
        </div> <!-- panel-body-->
    </div> <!-- end panel logging-->

{% endblock %}


{% block script %}
    <script>
        //提示信息消失时间
        var hidetime = 6000;
        var logtime = 1500;
        //设置标题导航栏为选中状态
        $("#DHTsetting").addClass("active");

        //当页面载入后，根据服务器记录的信息对按钮进行操作
        $(document).ready(function () {
            var oeostate1 = "{{ oeoinfo1.oeostate }}";
            var oeostate2 = "{{ oeoinfo2.oeostate }}";

            if(oeostate1=="on"){
                //如果服务器是启动的，则默认样式，不用做任何操作
            }else{
                //如果服务器是没有启动的
                $("#stopserver1").attr("disabled","disabled").removeClass("btn-danger");
                $("#startserver1").removeAttr("disabled").addClass("btn-success");
                $("#comformchange1").removeAttr("disabled").addClass("btn-warning");
                $(".oeoinput1").removeAttr("disabled");
            }

            if(oeostate2=="on"){
                //如果服务器是启动的，则默认样式，不用做任何操作
            }else{
                //如果服务器是没有启动的
                $("#stopserver2").attr("disabled","disabled").removeClass("btn-danger");
                $("#startserver2").removeAttr("disabled").addClass("btn-success");
                $("#comformchange2").removeAttr("disabled").addClass("btn-warning");
                $(".oeoinput2").removeAttr("disabled");
            }

            //获取log日志
            setTimeout(getlog,500);
        });


        $("#stopserver1").click(function () {
            $("#stopserver1").attr("disabled","disabled");
            $("#stopserver1").text("Runing...");

            $.ajax({
                url: "/ajax_oeosetting_stop/",
                type: "POST",
                data: {"Device":"1"},
                dataType: "json",
                success:function (data) {
                    $("#stopserver1").removeAttr("disabled");
                    $("#stopserver1").text("停止服务");

                    if(data["result"]=="success"){
                        ShowTopInfo1("alert-success","<strong>Success!</strong> OEO#1 服务暂停成功！");
                        //当点击停止服务的时候，自己按钮变暗；其它所有按钮启用
                        $("#stopserver1").attr("disabled","disabled").removeClass("btn-danger");
                        $("#startserver1").removeAttr("disabled").addClass("btn-success");
                        $("#comformchange1").removeAttr("disabled").addClass("btn-warning");
                        $(".oeoinput1").removeAttr("disabled");

                    }else{
                        ShowTopInfo1("alert-danger","<strong>Error!</strong> OEO#1 服务暂停失败！");
                    }
                    setTimeout(function () {$("#Topinfo1").empty();},hidetime);
                }
            }); // end ajax

            //获取log日志
            setTimeout(getlog,logtime);
        }); // end stop server

        $("#stopserver2").click(function () {
            $("#stopserver2").attr("disabled","disabled");
            $("#stopserver2").text("Runing...");

            $.ajax({
                url: "/ajax_oeosetting_stop/",
                type: "POST",
                data: {"Device":"2"},
                dataType: "json",
                success:function (data) {
                    $("#stopserver2").removeAttr("disabled");
                    $("#stopserver2").text("停止服务");

                    if(data["result"]=="success"){
                        ShowTopInfo1("alert-success","<strong>Success!</strong> OEO#2 服务暂停成功！");
                        //当点击停止服务的时候，自己按钮变暗；其它所有按钮启用
                        $("#stopserver2").attr("disabled","disabled").removeClass("btn-danger");
                        $("#startserver2").removeAttr("disabled").addClass("btn-success");
                        $("#comformchange2").removeAttr("disabled").addClass("btn-warning");
                        $(".oeoinput2").removeAttr("disabled");

                    }else{
                        ShowTopInfo1("alert-danger","<strong>Error!</strong> OEO#2 服务暂停失败！");
                    }
                    setTimeout(function () {$("#Topinfo1").empty();},hidetime);
                }
            }); // end ajax

            //获取log日志
            setTimeout(getlog,logtime);
        }); // end stop server

        $("#startserver1").click(function () {
            $("#startserver1").attr("disabled","disabled");
            $("#startserver1").text("Runing...");

            $.ajax({
                url: "/ajax_oeosetting_start/",
                type: "POST",
                data: {"Device":"1"},
                dataType: "json",
                success:function (data) {
                    $("#startserver1").removeAttr("disabled");
                    $("#startserver1").text("启动服务");

                    if(data["result"]=="success"){
                        ShowTopInfo1("alert-success","<strong>Success!</strong> OEO#1 服务启动成功！");
                        $("#stopserver1").removeAttr("disabled").addClass("btn-danger");
                        $("#startserver1").attr("disabled","disabled").removeClass("btn-success");
                        $("#comformchange1").attr("disabled","disabled").removeClass("btn-warning");
                        $(".oeoinput1").attr("disabled","disabled");

                    }else{
                        ShowTopInfo1("alert-danger","<strong>Error!</strong> OEO#1 服务启动失败！");
                    }
                    setTimeout(function () {$("#Topinfo1").empty();},hidetime);
                }
            }); //end ajax

            //获取log日志
            setTimeout(getlog,logtime);
        });// end start server

        $("#startserver2").click(function () {
            $("#startserver2").attr("disabled","disabled");
            $("#startserver2").text("Runing...");

            $.ajax({
                url: "/ajax_oeosetting_start/",
                type: "POST",
                data: {"Device":"2"},
                dataType: "json",
                success:function (data) {
                    $("#startserver2").removeAttr("disabled");
                    $("#startserver2").text("启动服务");

                    if(data["result"]=="success"){
                        ShowTopInfo1("alert-success","<strong>Success!</strong> OEO#2 服务启动成功！");
                        $("#stopserver2").removeAttr("disabled").addClass("btn-danger");
                        $("#startserver2").attr("disabled","disabled").removeClass("btn-success");
                        $("#comformchange2").attr("disabled","disabled").removeClass("btn-warning");
                        $(".oeoinput2").attr("disabled","disabled");

                    }else{
                        ShowTopInfo1("alert-danger","<strong>Error!</strong> OEO#2 服务启动失败！");
                    }
                    setTimeout(function () {$("#Topinfo1").empty();},hidetime);
                }
            }); //end ajax

            //获取log日志
            setTimeout(getlog,logtime);
        });// end start server

        $("#comformchange1").click(function () {
            $("#comformchange1").attr("disabled","disabled");
            $("#comformchange1").text("Runing...");

            //此时应该检查出入并更新数据库
            var oeonamein = $("#oeoname1").val();
            var oeoipin = $("#oeoip1").val();
            var oeoportin = $("#oeoport1").val();
            var oeokeyin = $("#oeokey1").val();

            $.ajax({
                url: "/ajax_oeosetting_change/",
                type: "POST",
                data: {"Device":"1",
                    "oeoname":oeonamein,"oeoip":oeoipin,
                    "oeoport":oeoportin,"oeokey":oeokeyin},
                dataType: "json",
                success:function (data) {
                    $("#comformchange1").removeAttr("disabled");
                    $("#comformchange1").text("确认修改");

                    if(data["result"]=="success"){
                        ShowTopInfo1("alert-success","<strong>Success!</strong> 写入数据库成功！");
                    }else{
                        ShowTopInfo1("alert-danger","<strong>Error!</strong> 请检查你的数据！");
                    }
                    setTimeout(function () {$("#Topinfo1").empty();},hidetime);
                }
            }); // end ajax

            //获取log日志
            setTimeout(getlog,logtime);
        }); // end change information

        $("#comformchange2").click(function () {
            $("#comformchange2").attr("disabled","disabled");
            $("#comformchange2").text("Runing...");

            //此时应该检查出入并更新数据库
            var oeonamein = $("#oeoname2").val();
            var oeoipin = $("#oeoip2").val();
            var oeoportin = $("#oeoport2").val();
            var oeokeyin = $("#oeokey2").val();

            $.ajax({
                url: "/ajax_oeosetting_change/",
                type: "POST",
                data: {"Device":"2",
                    "oeoname":oeonamein,"oeoip":oeoipin,
                    "oeoport":oeoportin,"oeokey":oeokeyin},
                dataType: "json",
                success:function (data) {
                    $("#comformchange2").removeAttr("disabled");
                    $("#comformchange2").text("确认修改");

                    if(data["result"]=="success"){
                        ShowTopInfo1("alert-success","<strong>Success!</strong> 写入数据库成功！");
                    }else{
                        ShowTopInfo1("alert-danger","<strong>Error!</strong> 请检查你的数据！");
                    }
                    setTimeout(function () {$("#Topinfo1").empty();},hidetime);
                }
            }); // end ajax

            //获取log日志
            setTimeout(getlog,logtime);
        }); // end change information

        //获取日志信息
        function getlog() {
            $.ajax({
                url: "/ajax_oeosetting_getlog/",
                type: "POST",
                data: {"None":"None"},
                dataType: "json",
                traditional:true,
                success:function (data) {
                    $("#tablelog").empty();
                    var count=data.data.length-1;
                    for(;count>=0;count-=3){
                        var addin = '<tr> <th scope="row">'+data.data[count-2]+
                            '</th> <td>'+data.data[count-1]+
                            '</td> <td>'+data.data[count]+
                            '</td> </tr>';
                        $("#tablelog").append(addin);
                    }
                }
            }); // end ajax
        } //end getlog


    </script>
{% endblock %}